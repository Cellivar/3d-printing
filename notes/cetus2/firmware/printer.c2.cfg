# This file for TT CETUS2.
#Macro definitions

#PRINT_START/START_PRINT            Power on motion system, home, set temperature and initiate printing

#PRINT_END/END_PRINT                End print job and power off motion system

#T0                                 Activate Extruder 1, an optional P value could be added to indicate mixing ratio. 
#                                   eg T0 P25 is assign 25% flow to extruder 1 and rest for extruder 2

#T1                                 Activate Extruder 2 and add optional mixing ratio.

#T2                                 No real action, just for displaying correct color in Orcaslicer and prevent warning 
#                                   message from Klipper, user could add more eg T3 T4...... if needed    

#M300                               Buzzer beep
#                                   eg M300 P500; beep on 0.5s    

#M301                               Motion system power on
#                                   eg M301 P1; power on
#                                   eg M301 P0; power off

#M305                               Set retraction length and speed of firmware retraction
#                                   eg M305 L1.5 F5000; length is 1.5, speed is 5000

#M306                               Set current extruder mixing ratio
#                                   eg M306 P25; mix ratio percent is 25%

#M308                               Set Z offset
#G10                                Firmware retraction
#G11                                Firmware de-retraction
#G32                                Mesh bed leveling

#MIX                                Vertical Gradient Mixing. Gradient adjust automatically to print height.
#                                   MIX P=1 ;current extruder gradually increase flow from 11% to 88%; 
#                                   MIX P=2 ;current extruder gradually decrease flow from 88%% to 11%. 
#                                   MIX P=1 X=1; X is a speed factor that determines how fast the gradient will reach maximum/minimum. 
#                                   eg X=1 is proportional to model height, X=0.5 will produce a longer gradient while X=2 will produce 
#                                   a gradient half the height of the model.

#INPUT SHAPER command:
#                                   SHAPER_CALIBRATE AXIS=X
#                                   SHAPER_CALIBRATE AXIS=Y

#BED MESH command:
#                                   BED_MESH_CALIBRATE

#PID_CALIBRATE command:
#                                   PID_CALIBRATE HEATER=extruder TARGET=250
#                                   PID_CALIBRATE HEATER=heater_bed TARGET=60
[mcu]
serial = /dev/ttyACM0
restart_method = command


[adc_temperature V51RNTC100K510RG]
temperature1 = 0
voltage1 = 0.005167951
temperature2 = 100
voltage2 = 0.236675573
temperature3 = 200
voltage3 = 1.512265253
temperature4 = 300
voltage4 = 2.537313433

[adc_temperature V510RNTC100K10KRG]
temperature1 = 0
voltage1 = 0.098328417
temperature2 = 100
voltage2 = 1.934349355
temperature3 = 300
voltage3 = 3.109599239

[display_status]

[idle_timeout]
timeout = 360000

[virtual_sdcard]
path = /home/tier/printer_data/gcodes

[save_variables]
filename = variables.cfg

[probe]
deactivate_on_each_sample = True
samples = 3
samples_result = median
sample_retract_dist = 3.0
samples_tolerance = 0.1
activate_gcode = 
	G4 P1500
#z_offset = -0.220
y_offset = 0
x_offset = 0
pin = !PC10
speed = 3
lift_speed = 1.5
samples_tolerance_retries = 5

[delayed_gcode bed_mesh_init]
initial_duration = .01
gcode = 
	
	BED_MESH_PROFILE LOAD=default

[gcode_macro VAR_EXTRUDER]
variable_extruder_selected = -1
variable_extruder_follow = -1
variable_retract_length = 1.5
variable_retract_speed = 5000
variable_t0_distance = 29
variable_t1_distance = 29
variable_min_percent = 20
variable_max_percent = 80
variable_current_percent = 20
variable_current_percent0 = 20
variable_current_percent1 = 20
variable_current_percent2 = 20
variable_current_percent3 = 20
variable_current_percent4 = 20
variable_current_percent5 = 20
variable_current_percent6 = 20
variable_current_percent7 = 20
variable_current_percent8 = 20
variable_current_percent9 = 20
variable_current_num:0
variable_current_num0:0
variable_current_num1:0
variable_current_num2:0
variable_current_num3:0
variable_current_num4:0
variable_current_num5:0
variable_current_num6:0
variable_current_num7:0
variable_current_num8:0
variable_current_num9:0
variable_position_z = 0
variable_probe = -1
variable_temp0 = -1
variable_temp1 = -1
gcode = 

[gcode_macro VAR_PRINT]
variable_is_probe = -1
variable_is_bedmesh = -1
variable_is_home = -1
variable_is_pause = -1
gcode = 

[gcode_macro M300]
description = Buzzer beep
gcode = 
	{% set P = params.P|default(500)|int %}
	SET_PIN PIN=BEEP VALUE=1
	G4 P{P}
	SET_PIN PIN=BEEP VALUE=0

[pause_resume]

[gcode_macro PAUSE]
description = Pause printing
rename_existing = PAUSE_BASE
gcode = 
	{% if printer["gcode_macro VAR_MODEL"].extrudr_num == 2 %}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=temp0 VALUE={printer.extruder.target}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=temp1 VALUE={printer.extruder1.target}
	M104 T1 S150
	M104 T0 S150
	{% elif printer["gcode_macro VAR_MODEL"].extrudr_num == 1 %}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=temp0 VALUE={printer.extruder.target}
	M104 T0 S150
	{% endif %}
	PAUSE_BASE
	G91
	G1 E-2.0 F2000
	G1 Z2 F600
	G90

[gcode_macro RESUME]
description = Resume printing
rename_existing = RESUME_BASE
gcode = 
	{% if printer["gcode_macro VAR_MODEL"].extrudr_num == 2 %}
	M109 T1 S{printer["gcode_macro VAR_EXTRUDER"].temp1}
	M109 T0 S{printer["gcode_macro VAR_EXTRUDER"].temp0}
	{% elif printer["gcode_macro VAR_MODEL"].extrudr_num == 1 %}
	M109 T0 S{printer["gcode_macro VAR_EXTRUDER"].temp0}
	{% endif %}
	M300
	RESUME_BASE

[gcode_macro PID_EXTRUDER]
description = PID_CALIBRATE EXTRUER AT 250
gcode = 
	PID_CALIBRATE HEATER=extruder TARGET=250

[gcode_macro M305]
description: Set retraction length and speed of firmware retraction
gcode:
    {% set L = params.L|default(1.5)|float %}
    {% set F = params.F|default(5000)|int %}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=retract_length VALUE={L}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=retract_speed VALUE={F}

[gcode_macro M308]
description = Set Z offset
gcode = 
	{% set P = params.P|default(-11)|float %}
	{% if P < -10 %}
	{% if printer["gcode_macro VAR_EXTRUDER"].position_z == 0 %}
	{% set Z = (printer.probe.last_z_result+0.2)|float %}
	SET_GCODE_OFFSET Z_ADJUST={Z}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={Z}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={Z}
	{% else %}
	{% endif %}
	{% elif P == 0 %}
	{% set Z = (-printer["gcode_macro VAR_EXTRUDER"].position_z)|float %}
	SET_GCODE_OFFSET Z_ADJUST={Z}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE=0
	SAVE_VARIABLE VARIABLE=zoffset VALUE=0
	{% else %}
	{% if printer["gcode_macro VAR_EXTRUDER"].position_z == 0 %}
	{% set Z = (P-printer["gcode_macro VAR_EXTRUDER"].position_z)|float %}
	SET_GCODE_OFFSET Z_ADJUST={Z}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={P}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={P}
	{% else %}
	{% set Z = (P-printer["gcode_macro VAR_EXTRUDER"].position_z)|float %}
	SET_GCODE_OFFSET Z_ADJUST={Z}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={P}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={P}
	{% endif %}
	{% endif %}

[gcode_macro SZOFFSET]
description = Set Z offset
gcode = 
	{% set svv = printer.save_variables.variables %}
	{% set Z1 = svv.zoffset|float %}
	{% set Z2 = (printer.gcode_move.position.z+0.2)|float %}
	{% if Z2|abs > 2 %}
	G91
	G1 Z5 F3000
	G90
	CANCEL_PRINT
	{% endif %}
	{% if Z1|abs > 2 %}
	SET_GCODE_OFFSET Z={Z2}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={Z2}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={Z2}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=probe VALUE=1
	{% else %}
	{% if printer.extruder.temperature > 80 %}
	{% if printer["gcode_macro VAR_EXTRUDER"].probe == -1 %}
	SET_GCODE_OFFSET Z={Z2}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={Z2}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={Z2}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=probe VALUE=1
	{% else %}
	SET_GCODE_OFFSET Z={Z1}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={Z1}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={Z1}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=probe VALUE=1
	{% endif %}
	{% else %}
	SET_GCODE_OFFSET Z={Z2}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=position_z VALUE={Z2}
	SAVE_VARIABLE VARIABLE=zoffset VALUE={Z2}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=probe VALUE=1
	{% endif %}
	{% endif %}

[gcode_macro CLEANPROBE]
description = CLEAN NUZZLE AND PROBE
gcode = 
	{% if "xyz" in printer.toolhead.homed_axes %}
	{% set EXTRUDER_TEMP = params.TEMP|default(200)|int %}
	{% if EXTRUDER_TEMP < 180 %}
	{% set EXTRUDER_TEMP = 180 %}
	{% elif EXTRUDER_TEMP > 220 %}
	{% set EXTRUDER_TEMP = 220 %}
	{% endif %}
	M104 T1 S{EXTRUDER_TEMP}
	M109 T0 S{EXTRUDER_TEMP}
	M109 T1 S{EXTRUDER_TEMP}
	G90
	G1 X5 Y5 F7000
	probe
	G91
	G1 Y10 F1000
	G1 Y50 Z0.2 F7000
	G1 Z10 F2000
	probe
	G1 Y10 F1000
	G1 Y50 Z0.2 F7000
	G90
	G1 X{printer.toolhead.axis_maximum.x/2 |int} Y{printer.toolhead.axis_maximum.y/2 |int} Z5 F3000
	probe
	SZOFFSET
	G91
	G1 Z5 F3000
	G90
	{% set EXTRUDER_TEMP = 0 %}
	M104 T1 S{EXTRUDER_TEMP}
	M104 T0 S{EXTRUDER_TEMP}
	{% else %}
	G28
	{% endif %}

[homing_override]
gcode = 
	M301
	BED_MESH_CLEAR
	SET_KINEMATIC_POSITION X=0 Y=0 Z=0
	FORCE_MOVE STEPPER=stepper_z DISTANCE=50 VELOCITY=10 ACCEL=50
	G4 P200
	FORCE_MOVE STEPPER=stepper_y DISTANCE=50 VELOCITY=50 ACCEL=100
	G4 P200
	{% set X = params.X|default(1000)|int %}
	{% set Y = params.Y|default(1000)|int %}
	{% set Z = params.Z|default(1000)|int %}
	{% set XY = params.XY|default(1000)|int %}
	{% set XZ = params.XZ|default(1000)|int %}
	{% set YZ = params.YZ|default(1000)|int %}
	{% set XYZ = params.XYZ|default(1000)|int %}
	{% set H = 0 %}
	{% if X == 0 %}
	G28 X
	G91
	G1 X10 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	{% if Y == 0 %}
	G28 Y
	G91
	G1 Y10 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	{% if Z == 0 %}
	G28 Z
	G91
	G1 Z10 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	{% if XY == 0 %}
	G28 X
	G91
	G1 X10 F3000
	G28 Y
	G91
	G1 Y10 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	{% if XZ == 0 %}
	G28 X
	G91
	G1 X10 F3000
	G28 Z
	G91
	G1 Z10 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	{% if YZ == 0 %}
	G28 Y
	G91
	G1 Y10 F3000
	G28 Z
	G91
	G1 Z10 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	{% if H == 0 %}
	G28 X
	G91
	G1 X10 F3000
	G28 Y
	G91
	G1 Y10 F3000
	G28 Z
	G91
	G1 Z10 F3000
	G90
	G1 X{(printer.toolhead.axis_maximum.x |int - 100)} F3000
	G1 Y{(printer.toolhead.axis_maximum.y/2 |int - 0)} F3000
	G1 Z100 F3000
	{% set H = 1 %}
	{% else %}
	{% endif %}
	BED_MESH_PROFILE LOAD="default"
axes = xyz

[gcode_macro T0]
description = Activate Extruder 1, an optional P value could be added to indicate mixing ratio. eg T0 P25 is assign 25% flow to extruder 1 and rest for extruder 2
gcode = 
	{% set P = params.P|default(100)|int %}
	{% if P == 0 %}
	T1
	{% elif P == 100 %}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_selected VALUE=0
	ACTIVATE_EXTRUDER EXTRUDER=extruder
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder1
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder MOTION_QUEUE=extruder
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE=29
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=-1
	{% else %}
	{% if P < printer["gcode_macro VAR_EXTRUDER"].min_percent %}
	{% set P = printer["gcode_macro VAR_EXTRUDER"].min_percent %}
	{% endif %}
	{% if P > printer["gcode_macro VAR_EXTRUDER"].max_percent %}
	{% set P = printer["gcode_macro VAR_EXTRUDER"].max_percent %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_selected VALUE=0
	ACTIVATE_EXTRUDER EXTRUDER=extruder
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE={(29*100/P)}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE={(29*100/P)}
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE={(29*100/(100-P))}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE={(29*100/(100-P))}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=10
	{% endif %}

[gcode_macro T1]
description = Activate Extruder 2 and add optional mixing ratio.
gcode = 
	{% set P = params.P|default(100)|int %}
	{% if P == 0 %}
	T0
	{% elif P == 100 %}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_selected VALUE=1
	ACTIVATE_EXTRUDER EXTRUDER=extruder1
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder MOTION_QUEUE=extruder
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder1
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE=29
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=-1
	{% else %}
	{% if P < printer["gcode_macro VAR_EXTRUDER"].min_percent %}
	{% set P = printer["gcode_macro VAR_EXTRUDER"].min_percent %}
	{% endif %}
	{% if P > printer["gcode_macro VAR_EXTRUDER"].max_percent %}
	{% set P = printer["gcode_macro VAR_EXTRUDER"].max_percent %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_selected VALUE=1
	ACTIVATE_EXTRUDER EXTRUDER=extruder1
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder MOTION_QUEUE=extruder1
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE={(29*100/(100-P))}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE={(29*100/(100-P))}
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE={(29*100/P)}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE={(29*100/P)}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=1
	{% endif %}

[gcode_macro T2]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T3]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T4]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T5]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T6]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T7]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T8]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T9]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro T10]
description = No real action, just for displaying correct color in Orcaslicer and prevent warning message from Klipper
gcode = 

[gcode_macro M306]
description = Set current extruder mixing ratio
gcode = 
	{% set P = params.P|default(0)|int %}
	{% if P == 0 %}
	{% if printer["gcode_macro VAR_EXTRUDER"].extruder_selected|int == 1 %}
	ACTIVATE_EXTRUDER EXTRUDER=extruder1
	{% elif printer["gcode_macro VAR_EXTRUDER"].extruder_selected|int == 0 %}
	ACTIVATE_EXTRUDER EXTRUDER=extruder
	{% endif %}
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE=29
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE=29
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder1
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder MOTION_QUEUE=extruder
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=-1
	{% elif P == 100 %}
	{% if printer["gcode_macro VAR_EXTRUDER"].extruder_selected|int == 1 %}
	ACTIVATE_EXTRUDER EXTRUDER=extruder1
	{% elif printer["gcode_macro VAR_EXTRUDER"].extruder_selected|int == 0 %}
	ACTIVATE_EXTRUDER EXTRUDER=extruder
	{% endif %}
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE=29
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE=29
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE=29
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder1
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder MOTION_QUEUE=extruder
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=-1
	{% else %}
	{% if P < printer["gcode_macro VAR_EXTRUDER"].min_percent %}
	{% set P = printer["gcode_macro VAR_EXTRUDER"].min_percent %}
	{% endif %}
	{% if P > printer["gcode_macro VAR_EXTRUDER"].max_percent %}
	{% set P = printer["gcode_macro VAR_EXTRUDER"].max_percent %}
	{% endif %}
	{% if printer["gcode_macro VAR_EXTRUDER"].extruder_selected|int == 1 %}
	ACTIVATE_EXTRUDER EXTRUDER=extruder1
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder MOTION_QUEUE=extruder1
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=1
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE={(29*100/(100-P))}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE={(29*100/(100-P))}
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE={(29*100/P)}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE={(29*100/P)}
	{% endif %}
	{% if printer["gcode_macro VAR_EXTRUDER"].extruder_selected|int == 0 %}
	ACTIVATE_EXTRUDER EXTRUDER=extruder
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=10
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder DISTANCE={(29*100/P)}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE={(29*100/P)}
	SET_EXTRUDER_ROTATION_DISTANCE EXTRUDER=extruder1 DISTANCE={(29*100/(100-P))}
	SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE={(29*100/(100-P))}
	{% endif %}
	{% endif %}

[gcode_macro MIX]   
description: Vertical Gradient Mixing. Gradient adjust automatically to print height.                       #2023-6-6 -Thomas
gcode:
    {% set C = params.C|default(0)|int %}                                           #2024-1-26 Thomas 材料定义数量
    {% set P = params.P|default(1)|int %}                                           #2024-1-26 Thomas 模式：0- 随机；1- 低到高；2-高到低；3-up循环；4-down循环；
    {% set X = params.X|default(1)|float %}                                         #2024-1-26 Thomas 斜率
    {% set DELTA = 0.1 %}
    {% set MIN = (printer["gcode_macro VAR_EXTRUDER"].min_percent) %}
    {% set MAX = (printer["gcode_macro VAR_EXTRUDER"].max_percent) %}
    {% set LAYER = ((printer.print_stats.info.total_layer|int) - 1) %}    
    {% set CURRENT = (printer["gcode_macro VAR_EXTRUDER"].current_percent) %}
    {% set CURRENT0 = (printer["gcode_macro VAR_EXTRUDER"].current_percent0) %}
    {% set CURRENT1 = (printer["gcode_macro VAR_EXTRUDER"].current_percent1) %}
    {% set CURRENT2 = (printer["gcode_macro VAR_EXTRUDER"].current_percent2) %}
    {% set CURRENT3 = (printer["gcode_macro VAR_EXTRUDER"].current_percent3) %}
    {% set CURRENT4 = (printer["gcode_macro VAR_EXTRUDER"].current_percent4) %}
    {% set CURRENT5 = (printer["gcode_macro VAR_EXTRUDER"].current_percent5) %}
    {% set CURRENT6 = (printer["gcode_macro VAR_EXTRUDER"].current_percent6) %}
    {% set CURRENT7 = (printer["gcode_macro VAR_EXTRUDER"].current_percent7) %}
    {% set CURRENT8 = (printer["gcode_macro VAR_EXTRUDER"].current_percent8) %}
    {% set CURRENT9 = (printer["gcode_macro VAR_EXTRUDER"].current_percent9) %}    
    {% set NUM = (printer["gcode_macro VAR_EXTRUDER"].current_num) %}
    {% set NUM0 = (printer["gcode_macro VAR_EXTRUDER"].current_num0) %}
    {% set NUM1 = (printer["gcode_macro VAR_EXTRUDER"].current_num1) %}
    {% set NUM2 = (printer["gcode_macro VAR_EXTRUDER"].current_num2) %}
    {% set NUM3 = (printer["gcode_macro VAR_EXTRUDER"].current_num3) %}
    {% set NUM4 = (printer["gcode_macro VAR_EXTRUDER"].current_num4) %}
    {% set NUM5 = (printer["gcode_macro VAR_EXTRUDER"].current_num5) %}
    {% set NUM6 = (printer["gcode_macro VAR_EXTRUDER"].current_num6) %}
    {% set NUM7 = (printer["gcode_macro VAR_EXTRUDER"].current_num7) %}
    {% set NUM8 = (printer["gcode_macro VAR_EXTRUDER"].current_num8) %}
    {% set NUM9 = (printer["gcode_macro VAR_EXTRUDER"].current_num9) %}
    {% if P == 0 %}
      {% set T = range(MIN, MAX) | random %}
  	  {% if C == 0 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT0: {T}
	    {% elif C == 1 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT1: {T}
	    {% elif C == 2 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT2: {T}
  	  {% elif C == 3 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT3: {T}
	    {% elif C == 4 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT4: {T}
	    {% elif C == 5 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT5: {T}
  	  {% elif C == 6 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT6: {T}
	    {% elif C == 7 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT7: {T}
	    {% elif C == 8 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT8: {T}
  	  {% elif C == 9 %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT9: {T}
	    {% else %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={T}
        M306 P{T}
        M118 CURRENTPERCENT: {T}
	    {% endif %}
    {% elif P == 1 %}
	    {% if C == 0 %}
        {% if CURRENT0 < MAX %}
          M306 P{CURRENT0}
          M118 CURRENTPERCENT0: {CURRENT0}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(CURRENT0+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(CURRENT0+1)}
          {% endif %}
        {% elif CURRENT0 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT0: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT0: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 1 %}
        {% if CURRENT1 < MAX %}
          M306 P{CURRENT1}
          M118 CURRENTPERCENT1: {CURRENT1}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(CURRENT1+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(CURRENT1+1)}
          {% endif %}
        {% elif CURRENT1 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT1: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT1: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 2 %}
        {% if CURRENT2 < MAX %}
          M306 P{CURRENT2}
          M118 CURRENTPERCENT2: {CURRENT2}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(CURRENT2+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(CURRENT2+1)}
          {% endif %}
        {% elif CURRENT2 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT2: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT2: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 3 %}
        {% if CURRENT3 < MAX %}
          M306 P{CURRENT3}
          M118 CURRENTPERCENT3: {CURRENT3}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(CURRENT3+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(CURRENT3+1)}
          {% endif %}
        {% elif CURRENT3 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT3: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT3: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 4 %}
        {% if CURRENT4 < MAX %}
          M306 P{CURRENT4}
          M118 CURRENTPERCENT4: {CURRENT4}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(CURRENT4+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(CURRENT4+1)}
          {% endif %}
        {% elif CURRENT4 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT4: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT4: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 5 %}
        {% if CURRENT5 < MAX %}
          M306 P{CURRENT5}
          M118 CURRENTPERCENT5: {CURRENT5}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(CURRENT5+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(CURRENT5+1)}
          {% endif %}
        {% elif CURRENT5 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT5: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT5: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 6 %}
        {% if CURRENT6 < MAX %}
          M306 P{CURRENT6}
          M118 CURRENTPERCENT6: {CURRENT6}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(CURRENT6+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(CURRENT6+1)}
          {% endif %}
        {% elif CURRENT6 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT6: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT6: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 7 %}
        {% if CURRENT7 < MAX %}
          M306 P{CURRENT7}
          M118 CURRENTPERCENT7: {CURRENT7}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(CURRENT7+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(CURRENT7+1)}
          {% endif %}
        {% elif CURRENT7 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT7: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT7: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 8 %}
        {% if CURRENT8 < MAX %}
          M306 P{CURRENT8}
          M118 CURRENTPERCENT8: {CURRENT8}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(CURRENT8+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(CURRENT8+1)}
          {% endif %}
        {% elif CURRENT8 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT8: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT8: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% elif C == 9 %}
        {% if CURRENT9 < MAX %}
          M306 P{CURRENT9}
          M118 CURRENTPERCENT9: {CURRENT9}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(CURRENT9+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(CURRENT9+1)}
          {% endif %}
        {% elif CURRENT9 < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT9: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT9: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% else %}
        {% if CURRENT < MAX %}
          M306 P{CURRENT}
          M118 CURRENTPERCENT: {CURRENT}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(CURRENT+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(CURRENT+1)}
          {% endif %}
        {% elif CURRENT < (MAX + DELTA) %}
          M306 P{MAX}
          M118 CURRENTPERCENT: {MAX}
          SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MIN}
        {% else %}
          M306 P{MIN}
          M118 CURRENTPERCENT: {MIN}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(MIN+1*X*(MAX-MIN)/LAYER)}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(MIN+1)}
          {% endif %}
        {% endif %} 
	    {% endif %}
    {% elif P == 2 %}
      {% if CURRENT == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT0 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT1 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT2 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT3 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT4 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT5 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT6 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT7 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT8 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MAX}
      {% else %}
      {% endif %}  
      {% if CURRENT9 == MIN %}
        SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MAX}
      {% else %}
      {% endif %}  
	    {% if C == 0 %}
        {% if MIN < CURRENT0 %}
          M306 P{CURRENT0}
          M118 CURRENTPERCENT0: {CURRENT0}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(CURRENT0-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(CURRENT0-1)}
          {% endif %}
        {% elif MIN == CURRENT0 %}
          M306 P{MAX}
          M118 CURRENTPERCENT0: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT0 + DELTA)%}
          M306 P{CURRENT0}
          M118 CURRENTPERCENT0: {CURRENT0}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(CURRENT0-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(CURRENT0-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT0: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 1 %}
        {% if MIN < CURRENT1 %}
          M306 P{CURRENT1}
          M118 CURRENTPERCENT1: {CURRENT1}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(CURRENT1-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(CURRENT1-1)}
          {% endif %}
        {% elif MIN == CURRENT1 %}
          M306 P{MAX}
          M118 CURRENTPERCENT1: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT1 + DELTA)%}
          M306 P{CURRENT1}
          M118 CURRENTPERCENT1: {CURRENT1}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(CURRENT1-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(CURRENT1-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT1: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 2 %}
        {% if MIN < CURRENT2 %}
          M306 P{CURRENT2}
          M118 CURRENTPERCENT2: {CURRENT2}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(CURRENT2-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(CURRENT2-1)}
          {% endif %}
        {% elif MIN == CURRENT2 %}
          M306 P{MAX}
          M118 CURRENTPERCENT2: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT2 + DELTA)%}
          M306 P{CURRENT2}
          M118 CURRENTPERCENT2: {CURRENT2}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(CURRENT2-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(CURRENT2-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT2: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 3 %}
        {% if MIN < CURRENT3 %}
          M306 P{CURRENT3}
          M118 CURRENTPERCENT3: {CURRENT3}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(CURRENT3-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(CURRENT3-1)}
          {% endif %}
        {% elif MIN == CURRENT3 %}
          M306 P{MAX}
          M118 CURRENTPERCENT3: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT3 + DELTA)%}
          M306 P{CURRENT3}
          M118 CURRENTPERCENT3: {CURRENT3}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(CURRENT3-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(CURRENT3-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT3: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 4 %}
        {% if MIN < CURRENT4 %}
          M306 P{CURRENT4}
          M118 CURRENTPERCENT4: {CURRENT4}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(CURRENT4-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(CURRENT4-1)}
          {% endif %}
        {% elif MIN == CURRENT4 %}
          M306 P{MAX}
          M118 CURRENTPERCENT4: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT4 + DELTA)%}
          M306 P{CURRENT4}
          M118 CURRENTPERCENT4: {CURRENT4}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(CURRENT4-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(CURRENT4-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT4: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 5 %}
        {% if MIN < CURRENT5 %}
          M306 P{CURRENT5}
          M118 CURRENTPERCENT5: {CURRENT5}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(CURRENT5-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(CURRENT5-1)}
          {% endif %}
        {% elif MIN == CURRENT5 %}
          M306 P{MAX}
          M118 CURRENTPERCENT5: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT5 + DELTA)%}
          M306 P{CURRENT5}
          M118 CURRENTPERCENT5: {CURRENT5}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(CURRENT5-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(CURRENT5-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT5: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 6 %}
        {% if MIN < CURRENT6 %}
          M306 P{CURRENT6}
          M118 CURRENTPERCENT6: {CURRENT6}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(CURRENT6-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(CURRENT6-1)}
          {% endif %}
        {% elif MIN == CURRENT6 %}
          M306 P{MAX}
          M118 CURRENTPERCENT6: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT6 + DELTA)%}
          M306 P{CURRENT6}
          M118 CURRENTPERCENT6: {CURRENT6}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(CURRENT6-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(CURRENT6-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT6: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 7 %}
        {% if MIN < CURRENT7 %}
          M306 P{CURRENT7}
          M118 CURRENTPERCENT7: {CURRENT7}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(CURRENT7-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(CURRENT7-1)}
          {% endif %}
        {% elif MIN == CURRENT7 %}
          M306 P{MAX}
          M118 CURRENTPERCENT7: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT7 + DELTA)%}
          M306 P{CURRENT7}
          M118 CURRENTPERCENT7: {CURRENT7}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(CURRENT7-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(CURRENT7-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT7: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 8 %}
        {% if MIN < CURRENT8 %}
          M306 P{CURRENT8}
          M118 CURRENTPERCENT8: {CURRENT8}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(CURRENT8-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(CURRENT8-1)}
          {% endif %}
        {% elif MIN == CURRENT8 %}
          M306 P{MAX}
          M118 CURRENTPERCENT8: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT8 + DELTA)%}
          M306 P{CURRENT8}
          M118 CURRENTPERCENT8: {CURRENT8}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(CURRENT8-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(CURRENT8-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT8: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% elif C == 9 %}
        {% if MIN < CURRENT9 %}
          M306 P{CURRENT9}
          M118 CURRENTPERCENT9: {CURRENT9}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(CURRENT9-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(CURRENT9-1)}
          {% endif %}
        {% elif MIN == CURRENT9 %}
          M306 P{MAX}
          M118 CURRENTPERCENT9: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT9 + DELTA)%}
          M306 P{CURRENT9}
          M118 CURRENTPERCENT9: {CURRENT9}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(CURRENT9-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(CURRENT9-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT9: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% else %}
        {% if MIN < CURRENT %}
          M306 P{CURRENT}
          M118 CURRENTPERCENT: {CURRENT}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(CURRENT-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(CURRENT-1)}
          {% endif %}
        {% elif MIN == CURRENT %}
          M306 P{MAX}
          M118 CURRENTPERCENT: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(MAX-1)}
          {% endif %}
        {% elif MIN < (CURRENT + DELTA)%}
          M306 P{CURRENT}
          M118 CURRENTPERCENT: {CURRENT}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(CURRENT-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(CURRENT-1)}
          {% endif %}
        {% else %}
          M306 P{MAX}
          M118 CURRENTPERCENT: {MAX}
          {% if LAYER > 0 %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(MAX-1*X*(MAX-MIN)/(LAYER))}
          {% else %}
            SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={(MAX-1)}
          {% endif %}
        {% endif %}
	    {% endif %}
    {% elif P == 3 %}
	    {% if C == 0 %}
        {% if NUM0 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP0 = (CURRENT0+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP0 = (CURRENT0+2*X) %}
          {% endif %}
          {% if CURRENT0 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT0: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={CURRENT_TEMP0}
          {% elif CURRENT0 < MAX %}
            {% if CURRENT_TEMP0 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT0: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num0 VALUE={(NUM0+1)}
            {% else %}
              M306 P{CURRENT0}
              M118 CURRENTPERCENT0: {CURRENT0}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={CURRENT_TEMP0}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP0 = (CURRENT0-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP0 = (CURRENT0-2*X) %}
          {% endif %}
          {% if MIN == CURRENT0 %}
              M306 P{MIN}
              M118 CURRENTPERCENT0: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={CURRENT_TEMP0}
          {% elif MIN < CURRENT0 %}
            {% if CURRENT_TEMP0 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT0: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num0 VALUE={(NUM0+1)}
            {% else %}
              M306 P{CURRENT_TEMP0}
              M118 CURRENTPERCENT0: {CURRENT_TEMP0}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={CURRENT_TEMP0}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 1 %}
        {% if NUM1 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP1 = (CURRENT1+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP1 = (CURRENT1+2*X) %}
          {% endif %}
          {% if CURRENT1 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT1: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={CURRENT_TEMP1}
          {% elif CURRENT1 < MAX %}
            {% if CURRENT_TEMP1 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT1: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num1 VALUE={(NUM1+1)}
            {% else %}
              M306 P{CURRENT1}
              M118 CURRENTPERCENT1: {CURRENT1}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={CURRENT_TEMP1}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP1 = (CURRENT1-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP1 = (CURRENT1-2*X) %}
          {% endif %}
          {% if MIN == CURRENT1 %}
              M306 P{MIN}
              M118 CURRENTPERCENT1: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={CURRENT_TEMP1}
          {% elif MIN < CURRENT1 %}
            {% if CURRENT_TEMP1 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT1: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num1 VALUE={(NUM1+1)}
            {% else %}
              M306 P{CURRENT_TEMP1}
              M118 CURRENTPERCENT1: {CURRENT_TEMP1}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={CURRENT_TEMP1}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 2 %}
        {% if NUM2 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP2 = (CURRENT2+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP2 = (CURRENT2+2*X) %}
          {% endif %}
          {% if CURRENT2 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT2: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={CURRENT_TEMP2}
          {% elif CURRENT2 < MAX %}
            {% if CURRENT_TEMP2 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT2: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num2 VALUE={(NUM2+1)}
            {% else %}
              M306 P{CURRENT2}
              M118 CURRENTPERCENT2: {CURRENT2}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={CURRENT_TEMP2}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP2 = (CURRENT2-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP2 = (CURRENT2-2*X) %}
          {% endif %}
          {% if MIN == CURRENT2 %}
              M306 P{MIN}
              M118 CURRENTPERCENT2: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={CURRENT_TEMP2}
          {% elif MIN < CURRENT2 %}
            {% if CURRENT_TEMP2 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT2: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num2 VALUE={(NUM2+1)}
            {% else %}
              M306 P{CURRENT_TEMP2}
              M118 CURRENTPERCENT2: {CURRENT_TEMP2}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={CURRENT_TEMP2}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 3 %}
        {% if NUM3 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP3 = (CURRENT3+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP3 = (CURRENT3+2*X) %}
          {% endif %}
          {% if CURRENT3 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT3: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={CURRENT_TEMP3}
          {% elif CURRENT3 < MAX %}
            {% if CURRENT_TEMP3 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT3: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num3 VALUE={(NUM3+1)}
            {% else %}
              M306 P{CURRENT3}
              M118 CURRENTPERCENT3: {CURRENT3}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={CURRENT_TEMP3}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP3 = (CURRENT3-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP3 = (CURRENT3-2*X) %}
          {% endif %}
          {% if MIN == CURRENT3 %}
              M306 P{MIN}
              M118 CURRENTPERCENT3: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={CURRENT_TEMP3}
          {% elif MIN < CURRENT3 %}
            {% if CURRENT_TEMP3 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT3: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num3 VALUE={(NUM3+1)}
            {% else %}
              M306 P{CURRENT_TEMP3}
              M118 CURRENTPERCENT3: {CURRENT_TEMP3}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={CURRENT_TEMP3}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 4 %}
        {% if NUM4 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP4 = (CURRENT4+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP4 = (CURRENT4+2*X) %}
          {% endif %}
          {% if CURRENT4 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT4: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={CURRENT_TEMP4}
          {% elif CURRENT4 < MAX %}
            {% if CURRENT_TEMP4 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT4: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num4 VALUE={(NUM4+1)}
            {% else %}
              M306 P{CURRENT4}
              M118 CURRENTPERCENT4: {CURRENT4}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={CURRENT_TEMP4}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP4 = (CURRENT4-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP4 = (CURRENT4-2*X) %}
          {% endif %}
          {% if MIN == CURRENT4 %}
              M306 P{MIN}
              M118 CURRENTPERCENT4: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={CURRENT_TEMP4}
          {% elif MIN < CURRENT4 %}
            {% if CURRENT_TEMP4 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT4: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num4 VALUE={(NUM4+1)}
            {% else %}
              M306 P{CURRENT_TEMP4}
              M118 CURRENTPERCENT4: {CURRENT_TEMP4}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={CURRENT_TEMP4}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 5 %}
        {% if NUM5 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP5 = (CURRENT5+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP5 = (CURRENT5+2*X) %}
          {% endif %}
          {% if CURRENT5 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT5: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={CURRENT_TEMP5}
          {% elif CURRENT5 < MAX %}
            {% if CURRENT_TEMP5 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT5: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num5 VALUE={(NUM5+1)}
            {% else %}
              M306 P{CURRENT5}
              M118 CURRENTPERCENT5: {CURRENT5}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={CURRENT_TEMP5}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP5 = (CURRENT5-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP5 = (CURRENT5-2*X) %}
          {% endif %}
          {% if MIN == CURRENT5 %}
              M306 P{MIN}
              M118 CURRENTPERCENT5: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={CURRENT_TEMP5}
          {% elif MIN < CURRENT5 %}
            {% if CURRENT_TEMP5 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT5: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num5 VALUE={(NUM5+1)}
            {% else %}
              M306 P{CURRENT_TEMP5}
              M118 CURRENTPERCENT5: {CURRENT_TEMP5}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={CURRENT_TEMP5}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 6 %}
        {% if NUM6 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP6 = (CURRENT6+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP6 = (CURRENT6+2*X) %}
          {% endif %}
          {% if CURRENT6 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT6: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={CURRENT_TEMP6}
          {% elif CURRENT6 < MAX %}
            {% if CURRENT_TEMP6 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT6: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num6 VALUE={(NUM6+1)}
            {% else %}
              M306 P{CURRENT6}
              M118 CURRENTPERCENT6: {CURRENT6}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={CURRENT_TEMP6}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP6 = (CURRENT6-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP6 = (CURRENT6-2*X) %}
          {% endif %}
          {% if MIN == CURRENT6 %}
              M306 P{MIN}
              M118 CURRENTPERCENT6: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={CURRENT_TEMP6}
          {% elif MIN < CURRENT6 %}
            {% if CURRENT_TEMP6 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT6: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num6 VALUE={(NUM6+1)}
            {% else %}
              M306 P{CURRENT_TEMP6}
              M118 CURRENTPERCENT6: {CURRENT_TEMP6}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={CURRENT_TEMP6}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 7 %}
        {% if NUM7 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP7 = (CURRENT7+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP7 = (CURRENT7+2*X) %}
          {% endif %}
          {% if CURRENT7 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT7: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={CURRENT_TEMP7}
          {% elif CURRENT7 < MAX %}
            {% if CURRENT_TEMP7 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT7: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num7 VALUE={(NUM7+1)}
            {% else %}
              M306 P{CURRENT7}
              M118 CURRENTPERCENT7: {CURRENT7}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={CURRENT_TEMP7}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP7 = (CURRENT7-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP7 = (CURRENT7-2*X) %}
          {% endif %}
          {% if MIN == CURRENT7 %}
              M306 P{MIN}
              M118 CURRENTPERCENT7: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={CURRENT_TEMP7}
          {% elif MIN < CURRENT7 %}
            {% if CURRENT_TEMP7 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT7: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num7 VALUE={(NUM7+1)}
            {% else %}
              M306 P{CURRENT_TEMP7}
              M118 CURRENTPERCENT7: {CURRENT_TEMP7}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={CURRENT_TEMP7}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 8 %}
        {% if NUM8 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP8 = (CURRENT8+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP8 = (CURRENT8+2*X) %}
          {% endif %}
          {% if CURRENT8 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT8: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={CURRENT_TEMP8}
          {% elif CURRENT8 < MAX %}
            {% if CURRENT_TEMP8 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT8: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num8 VALUE={(NUM8+1)}
            {% else %}
              M306 P{CURRENT8}
              M118 CURRENTPERCENT8: {CURRENT8}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={CURRENT_TEMP8}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP8 = (CURRENT8-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP8 = (CURRENT8-2*X) %}
          {% endif %}
          {% if MIN == CURRENT8 %}
              M306 P{MIN}
              M118 CURRENTPERCENT8: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={CURRENT_TEMP8}
          {% elif MIN < CURRENT8 %}
            {% if CURRENT_TEMP8 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT8: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num8 VALUE={(NUM8+1)}
            {% else %}
              M306 P{CURRENT_TEMP8}
              M118 CURRENTPERCENT8: {CURRENT_TEMP8}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={CURRENT_TEMP8}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% elif C == 9 %}
        {% if NUM9 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP9 = (CURRENT9+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP9 = (CURRENT9+2*X) %}
          {% endif %}
          {% if CURRENT9 == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT9: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={CURRENT_TEMP9}
          {% elif CURRENT9 < MAX %}
            {% if CURRENT_TEMP9 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT9: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num9 VALUE={(NUM9+1)}
            {% else %}
              M306 P{CURRENT9}
              M118 CURRENTPERCENT9: {CURRENT9}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={CURRENT_TEMP9}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP9 = (CURRENT9-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP9 = (CURRENT9-2*X) %}
          {% endif %}
          {% if MIN == CURRENT9 %}
              M306 P{MIN}
              M118 CURRENTPERCENT9: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={CURRENT_TEMP9}
          {% elif MIN < CURRENT9 %}
            {% if CURRENT_TEMP9 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT9: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num9 VALUE={(NUM9+1)}
            {% else %}
              M306 P{CURRENT_TEMP9}
              M118 CURRENTPERCENT9: {CURRENT_TEMP9}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={CURRENT_TEMP9}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% else %}
        {% if NUM % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP = (CURRENT+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP = (CURRENT+2*X) %}
          {% endif %}
          {% if CURRENT == MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={CURRENT_TEMP}
          {% elif CURRENT < MAX %}
            {% if CURRENT_TEMP > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num VALUE={(NUM+1)}
            {% else %}
              M306 P{CURRENT}
              M118 CURRENTPERCENT: {CURRENT}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={CURRENT_TEMP}
            {% endif %}
          {% else %}
          {% endif %} 
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP = (CURRENT-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP = (CURRENT-2*X) %}
          {% endif %}
          {% if MIN == CURRENT %}
              M306 P{MIN}
              M118 CURRENTPERCENT: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={CURRENT_TEMP}
          {% elif MIN < CURRENT %}
            {% if CURRENT_TEMP < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num VALUE={(NUM+1)}
            {% else %}
              M306 P{CURRENT_TEMP}
              M118 CURRENTPERCENT: {CURRENT_TEMP}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={CURRENT_TEMP}
            {% endif %}
          {% else %}
          {% endif %}
        {% endif %}
	    {% endif %}
    {% elif P == 4 %}
      # {% if CURRENT == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT0 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT1 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT2 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT3 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT4 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT5 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT6 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT7 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT8 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MAX}
      # {% else %}
      # {% endif %}  
      # {% if CURRENT9 == MIN %}
      #   SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MAX}
      # {% else %}
      # {% endif %}  
	    {% if C == 0 %}
        {% if NUM0 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP0 = (CURRENT0-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP0 = (CURRENT0-2*X) %}
          {% endif %}
          {% if MIN < CURRENT0 %}
            {% if CURRENT_TEMP0 <= MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT0: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num0 VALUE={(NUM0+1)}
            {% else %}
              M306 P{CURRENT_TEMP0}
              M118 CURRENTPERCENT0: {CURRENT_TEMP0}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={CURRENT_TEMP0}
            {% endif %}
          {% elif MIN == CURRENT0 %}
            {% if NUM0 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT0: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP0 = (CURRENT0+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP0 = (CURRENT0+2*X) %}
          {% endif %}
          {% if CURRENT0 < MAX %}
            {% if CURRENT_TEMP0 >= MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT0: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num0 VALUE={(NUM0+1)}
            {% else %}
              M306 P{CURRENT_TEMP0}
              M118 CURRENTPERCENT0: {CURRENT_TEMP0}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={CURRENT_TEMP0}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 1 %}
        {% if NUM1 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP1 = (CURRENT1-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP1 = (CURRENT1-2*X) %}
          {% endif %}
          {% if MIN < CURRENT1 %}
            {% if CURRENT_TEMP1 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT1: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num1 VALUE={(NUM1+1)}
            {% else %}
              M306 P{CURRENT_TEMP1}
              M118 CURRENTPERCENT1: {CURRENT_TEMP1}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={CURRENT_TEMP1}
            {% endif %}
          {% elif MIN == CURRENT1 %}
            {% if NUM1 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT1: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP1 = (CURRENT1+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP1 = (CURRENT1+2*X) %}
          {% endif %}
          {% if CURRENT1 < MAX %}
            {% if CURRENT_TEMP1 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT1: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num1 VALUE={(NUM1+1)}
            {% else %}
              M306 P{CURRENT_TEMP1}
              M118 CURRENTPERCENT1: {CURRENT_TEMP1}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={CURRENT_TEMP1}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 2 %}
        {% if NUM2 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP2 = (CURRENT2-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP2 = (CURRENT2-2*X) %}
          {% endif %}
          {% if MIN < CURRENT2 %}
            {% if CURRENT_TEMP2 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT2: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num2 VALUE={(NUM2+1)}
            {% else %}
              M306 P{CURRENT_TEMP2}
              M118 CURRENTPERCENT2: {CURRENT_TEMP2}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={CURRENT_TEMP2}
            {% endif %}
          {% elif MIN == CURRENT2 %}
            {% if NUM2 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT2: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP2 = (CURRENT2+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP2 = (CURRENT2+2*X) %}
          {% endif %}
          {% if CURRENT2 < MAX %}
            {% if CURRENT_TEMP2 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT2: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num2 VALUE={(NUM2+1)}
            {% else %}
              M306 P{CURRENT_TEMP2}
              M118 CURRENTPERCENT2: {CURRENT_TEMP2}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={CURRENT_TEMP2}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 3 %}
        {% if NUM3 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP3 = (CURRENT3-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP3 = (CURRENT3-2*X) %}
          {% endif %}
          {% if MIN < CURRENT3 %}
            {% if CURRENT_TEMP3 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT3: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num3 VALUE={(NUM3+1)}
            {% else %}
              M306 P{CURRENT_TEMP3}
              M118 CURRENTPERCENT3: {CURRENT_TEMP3}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={CURRENT_TEMP3}
            {% endif %}
          {% elif MIN == CURRENT3 %}
            {% if NUM3 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT3: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP3 = (CURRENT3+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP3 = (CURRENT3+2*X) %}
          {% endif %}
          {% if CURRENT3 < MAX %}
            {% if CURRENT_TEMP3 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT3: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num3 VALUE={(NUM3+1)}
            {% else %}
              M306 P{CURRENT_TEMP3}
              M118 CURRENTPERCENT3: {CURRENT_TEMP3}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={CURRENT_TEMP3}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 4 %}
        {% if NUM4 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP4 = (CURRENT4-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP4 = (CURRENT4-2*X) %}
          {% endif %}
          {% if MIN < CURRENT4 %}
            {% if CURRENT_TEMP4 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT4: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num4 VALUE={(NUM4+1)}
            {% else %}
              M306 P{CURRENT_TEMP4}
              M118 CURRENTPERCENT4: {CURRENT_TEMP4}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={CURRENT_TEMP4}
            {% endif %}
          {% elif MIN == CURRENT4 %}
            {% if NUM4 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT4: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP4 = (CURRENT4+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP4 = (CURRENT4+2*X) %}
          {% endif %}
          {% if CURRENT4 < MAX %}
            {% if CURRENT_TEMP4 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT4: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num4 VALUE={(NUM4+1)}
            {% else %}
              M306 P{CURRENT_TEMP4}
              M118 CURRENTPERCENT4: {CURRENT_TEMP4}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={CURRENT_TEMP4}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 5 %}
        {% if NUM5 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP5 = (CURRENT5-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP5 = (CURRENT5-2*X) %}
          {% endif %}
          {% if MIN < CURRENT5 %}
            {% if CURRENT_TEMP5 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT5: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num5 VALUE={(NUM5+1)}
            {% else %}
              M306 P{CURRENT_TEMP5}
              M118 CURRENTPERCENT5: {CURRENT_TEMP5}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={CURRENT_TEMP5}
            {% endif %}
          {% elif MIN == CURRENT5 %}
            {% if NUM5 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT5: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP5 = (CURRENT5+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP5 = (CURRENT5+2*X) %}
          {% endif %}
          {% if CURRENT5 < MAX %}
            {% if CURRENT_TEMP5 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT5: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num5 VALUE={(NUM5+1)}
            {% else %}
              M306 P{CURRENT_TEMP5}
              M118 CURRENTPERCENT5: {CURRENT_TEMP5}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={CURRENT_TEMP5}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 6 %}
        {% if NUM6 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP6 = (CURRENT6-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP6 = (CURRENT6-2*X) %}
          {% endif %}
          {% if MIN < CURRENT6 %}
            {% if CURRENT_TEMP6 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT6: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num6 VALUE={(NUM6+1)}
            {% else %}
              M306 P{CURRENT_TEMP6}
              M118 CURRENTPERCENT6: {CURRENT_TEMP6}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={CURRENT_TEMP6}
            {% endif %}
          {% elif MIN == CURRENT6 %}
            {% if NUM6 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT6: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP6 = (CURRENT6+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP6 = (CURRENT6+2*X) %}
          {% endif %}
          {% if CURRENT6 < MAX %}
            {% if CURRENT_TEMP6 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT6: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num6 VALUE={(NUM6+1)}
            {% else %}
              M306 P{CURRENT_TEMP6}
              M118 CURRENTPERCENT6: {CURRENT_TEMP6}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={CURRENT_TEMP6}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 7 %}
        {% if NUM7 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP7 = (CURRENT7-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP7 = (CURRENT7-2*X) %}
          {% endif %}
          {% if MIN < CURRENT7 %}
            {% if CURRENT_TEMP7 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT7: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num7 VALUE={(NUM7+1)}
            {% else %}
              M306 P{CURRENT_TEMP7}
              M118 CURRENTPERCENT7: {CURRENT_TEMP7}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={CURRENT_TEMP7}
            {% endif %}
          {% elif MIN == CURRENT7 %}
            {% if NUM7 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT7: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP7 = (CURRENT7+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP7 = (CURRENT7+2*X) %}
          {% endif %}
          {% if CURRENT7 < MAX %}
            {% if CURRENT_TEMP7 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT7: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num7 VALUE={(NUM7+1)}
            {% else %}
              M306 P{CURRENT_TEMP7}
              M118 CURRENTPERCENT7: {CURRENT_TEMP7}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={CURRENT_TEMP7}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 8 %}
        {% if NUM8 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP8 = (CURRENT8-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP8 = (CURRENT8-2*X) %}
          {% endif %}
          {% if MIN < CURRENT8 %}
            {% if CURRENT_TEMP8 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT8: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num8 VALUE={(NUM8+1)}
            {% else %}
              M306 P{CURRENT_TEMP8}
              M118 CURRENTPERCENT8: {CURRENT_TEMP8}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={CURRENT_TEMP8}
            {% endif %}
          {% elif MIN == CURRENT8 %}
            {% if NUM8 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT8: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP8 = (CURRENT8+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP8 = (CURRENT8+2*X) %}
          {% endif %}
          {% if CURRENT8 < MAX %}
            {% if CURRENT_TEMP8 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT8: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num8 VALUE={(NUM8+1)}
            {% else %}
              M306 P{CURRENT_TEMP8}
              M118 CURRENTPERCENT8: {CURRENT_TEMP8}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={CURRENT_TEMP8}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% elif C == 9 %}
        {% if NUM9 % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP9 = (CURRENT9-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP9 = (CURRENT9-2*X) %}
          {% endif %}
          {% if MIN < CURRENT9 %}
            {% if CURRENT_TEMP9 < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT9: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num9 VALUE={(NUM9+1)}
            {% else %}
              M306 P{CURRENT_TEMP9}
              M118 CURRENTPERCENT9: {CURRENT_TEMP9}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={CURRENT_TEMP9}
            {% endif %}
          {% elif MIN == CURRENT9 %}
            {% if NUM9 == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT9: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP9 = (CURRENT9+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP9 = (CURRENT9+2*X) %}
          {% endif %}
          {% if CURRENT9 < MAX %}
            {% if CURRENT_TEMP9 > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT9: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num9 VALUE={(NUM9+1)}
            {% else %}
              M306 P{CURRENT_TEMP9}
              M118 CURRENTPERCENT9: {CURRENT_TEMP9}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={CURRENT_TEMP9}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
	    {% else %}
        {% if NUM % 2 == 0 %}                              #偶数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP = (CURRENT-2*X*(MAX-MIN)/(LAYER)) %}
          {% else %}
            {% set CURRENT_TEMP = (CURRENT-2*X) %}
          {% endif %}
          {% if MIN < CURRENT %}
            {% if CURRENT_TEMP < MIN %}
              M306 P{MIN}
              M118 CURRENTPERCENT: {MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MIN}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num VALUE={(NUM+1)}
            {% else %}
              M306 P{CURRENT_TEMP}
              M118 CURRENTPERCENT: {CURRENT_TEMP}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={CURRENT_TEMP}
            {% endif %}
          {% elif MIN == CURRENT %}
            {% if NUM == 0 %} 
              M306 P{MAX}
              M118 CURRENTPERCENT: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MAX}
            {% else %}
            {% endif %}
          {% else %}
          {% endif %}
        {% else %}                                                        #奇数
          {% if LAYER > 0 %}
            {% set CURRENT_TEMP = (CURRENT+2*X*(MAX-MIN)/LAYER) %}
          {% else %}
            {% set CURRENT_TEMP = (CURRENT+2*X) %}
          {% endif %}
          {% if CURRENT < MAX %}
            {% if CURRENT_TEMP > MAX %}
              M306 P{MAX}
              M118 CURRENTPERCENT: {MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MAX}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num VALUE={(NUM+1)}
            {% else %}
              M306 P{CURRENT_TEMP}
              M118 CURRENTPERCENT: {CURRENT_TEMP}
              SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={CURRENT_TEMP}
            {% endif %}
          {% else %}
          {% endif %} 
        {% endif %}
      {% endif %}
	  {% else %}
    {% endif %}  

[gcode_macro M301]
description = Motion system power on
gcode = 
	{% set P = params.P|default(1)|int %}
	{% if P == 1 %}
	G4 P200
	SET_PIN PIN=POWER VALUE=1
	T0
	{% else %}
	SET_PIN PIN=POWER VALUE=0
	{% endif %}

[gcode_macro START_PRINT]
description = Power on motion system, home, set temperature and initiate printing
gcode = 
	{% set svv = printer.save_variables.variables %}
	{% set ISPROBE = params.ISPROBE|default(0)|int %}
	{% set ISBEDMESH = params.ISBEDMESH|default(0)|int %}
	{% set BED_TEMP = params.BED_TEMP|default(0)|int %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(0)|int %}
	{% if BED_TEMP == 0 %}
	{% set BED_TEMP = params.BED|default(0)|int %}
	{% endif %}
	{% if EXTRUDER_TEMP == 0 %}
	{% set EXTRUDER_TEMP = params.EXTRUDER|default(0)|int %}
	{% endif %}
	{% if EXTRUDER_TEMP == 0 %}
	CANCEL_PRINT
	{% endif %}
	CLEAR_PAUSE
	M301
	G90
	{% if "xyz" in printer.toolhead.homed_axes %}
	{% else %}
	G28
	{% endif %}
	{% if BED_TEMP == 0 %}
	{% else %}
	M140 S{BED_TEMP}
	{% endif %}
	{% if ISPROBE == 0 %}
	{% if printer["gcode_macro VAR_PRINT"].is_probe == 2 %}
	{% set ISPROBE = 2 %}
	{% elif printer["gcode_macro VAR_PRINT"].is_probe == 1 %}
	{% set ISPROBE = 1 %}
	{% else %}
	{% endif %}
	{% endif %}
	{% if ISBEDMESH == 0 %}
	{% if printer["gcode_macro VAR_PRINT"].is_bedmesh == 2 %}
	{% set ISBEDMESH = 2 %}
	{% elif printer["gcode_macro VAR_PRINT"].is_bedmesh == 1 %}
	{% set ISBEDMESH = 1 %}
	{% else %}
	{% endif %}
	{% endif %}
	{% if ISBEDMESH == 2 %}
	M190 S{BED_TEMP}
	BED_MESH_CALIBRATE
	G91
	G1 Z5 F3000
	G90
	G1 X{printer.toolhead.axis_maximum.x/2 |int} Y{printer.toolhead.axis_maximum.y/2 |int} Z10 F3000
	{% elif ISBEDMESH == 1 %}
	BED_MESH_CALIBRATE
	G91
	G1 Z5 F3000
	G90
	G1 X{printer.toolhead.axis_maximum.x/2 |int} Y{printer.toolhead.axis_maximum.y/2 |int} Z10 F3000
	{% else %}
	{% endif %}
	{% if ISPROBE == 2 %}
	CLEANPROBE TEMP={EXTRUDER_TEMP-50}
	{% elif ISPROBE == 1 %}
	G90
	G1 X{printer.toolhead.axis_maximum.x/2 |int} Y{printer.toolhead.axis_maximum.y/2 |int} Z5 F3000
	probe
	SZOFFSET
	{% else %}
	{% endif %}
	G90
	G1 X6 Y5 F5000
	G1 Z10 F3000
	G1 Z5 F300
	G1 Z0.2 F300
	{% if EXTRUDER_TEMP == 0 %}
	{% else %}
	M104 T1 S{EXTRUDER_TEMP}
	M109 T0 S{EXTRUDER_TEMP}
	M109 T1 S{EXTRUDER_TEMP}
	{% endif %}
	G91
	G1 Y10 F1000
	G1 Y50 F7000
	G90

[gcode_macro PRINT_START]
description = Power on motion system, home, set temperature and initiate printing
gcode = 
	{% set ISPROBE = params.ISPROBE|default(0)|int %}
	{% set ISBEDMESH = params.ISBEDMESH|default(0)|int %}
	{% set BED_TEMP = params.BED_TEMP|default(0)|int %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(0)|int %}
	{% if BED_TEMP == 0 %}
	{% set BED_TEMP = params.BED|default(0)|int %}
	{% endif %}
	{% if EXTRUDER_TEMP == 0 %}
	{% set EXTRUDER_TEMP = params.EXTRUDER|default(0)|int %}
	{% endif %}
	START_PRINT BED={BED_TEMP} EXTRUDER={EXTRUDER_TEMP} ISPROBE={ISPROBE} ISBEDMESH={ISBEDMESH}

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	CANCEL_PRINT_BASE
	M305 L1.5 F2000
	G10
	G91
	{% if (printer.toolhead.axis_maximum.z - printer.toolhead.position.z) > 200 %}
	G1 Z150 F2000
	{% elif (printer.toolhead.axis_maximum.z - printer.toolhead.position.z) > 100 %}
	G1 Z50 F2000
	{% elif (printer.toolhead.axis_maximum.z - printer.toolhead.position.z) > 50 %}
	G1 Z25 F2000
	{% else %}
	G1 Z{(printer.toolhead.axis_maximum.z - printer.toolhead.position.z)} F2000
	{% endif %}
	G90
	M84
	M300 P500
    {% set MIN = (printer["gcode_macro VAR_EXTRUDER"].min_percent) %}
    {% set MAX = (printer["gcode_macro VAR_EXTRUDER"].max_percent) %}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=-1
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE=29
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE=29
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_selected VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num0 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num1 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num2 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num3 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num4 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num5 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num6 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num7 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num8 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num9 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_PRINT VARIABLE=is_home VALUE=0

[gcode_macro END_PRINT]
description = End print job and power off motion system
gcode = 
	TURN_OFF_HEATERS
	M106 S0
	M305 L1.5 F2000
	G10
	G91
	G1 X-2 Y-2 F300
	{% if (printer.toolhead.axis_maximum.z - printer.toolhead.position.z) > 200 %}
	G1 Z150 F2000
	{% elif (printer.toolhead.axis_maximum.z - printer.toolhead.position.z) > 100 %}
	G1 Z50 F2000
	{% elif (printer.toolhead.axis_maximum.z - printer.toolhead.position.z) > 50 %}
	G1 Z25 F2000
	{% else %}
	G1 Z{(printer.toolhead.axis_maximum.z - printer.toolhead.position.z)} F2000
	{% endif %}
	G90
	M84
    {% set MIN = (printer["gcode_macro VAR_EXTRUDER"].min_percent) %}
    {% set MAX = (printer["gcode_macro VAR_EXTRUDER"].max_percent) %}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_follow VALUE=-1
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t0_distance VALUE=29
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=t1_distance VALUE=29
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=extruder_selected VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent0 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent1 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent2 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent3 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent4 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent5 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent6 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent7 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent8 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_percent9 VALUE={MIN}
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num0 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num1 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num2 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num3 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num4 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num5 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num6 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num7 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num8 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_EXTRUDER VARIABLE=current_num9 VALUE=0
    SET_GCODE_VARIABLE MACRO=VAR_PRINT VARIABLE=is_home VALUE=0

[gcode_macro PRINT_END]
description = End print job and power off motion system
gcode = 
	END_PRINT

[gcode_macro GET_TIMELAPSE_SETUP]
description = Print the Timelapse setup
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set output_txt = ["Timelapse Setup:"] %}
	{% set _dummy = output_txt.append("enable: %s" % tl.enable) %}
	{% set _dummy = output_txt.append("park: %s" % tl.park.enable) %}
	{% if tl.park.enable %}
	{% set _dummy = output_txt.append("park position: %s time: %s s" % (tl.park.pos, tl.park.time)) %}
	{% set _dummy = output_txt.append("park cord x:%s y:%s dz:%s" % (tl.park.coord.x, tl.park.coord.y, tl.park.coord.dz)) %}
	{% set _dummy = output_txt.append("travel speed: %s mm/s" % tl.speed.travel) %}
	{% endif %}
	{% set _dummy = output_txt.append("fw_retract: %s" % tl.extruder.fw_retract) %}
	{% if not tl.extruder.fw_retract %}
	{% set _dummy = output_txt.append("retract: %s mm speed: %s mm/s" % (tl.extruder.retract, tl.speed.retract)) %}
	{% set _dummy = output_txt.append("extrude: %s mm speed: %s mm/s" % (tl.extruder.extrude, tl.speed.extrude)) %}
	{% endif %}
	{% set _dummy = output_txt.append("verbose: %s" % tl.verbose) %}
	{action_respond_info(output_txt|join("\n"))}

[gcode_macro _SET_TIMELAPSE_SETUP]
description = Set user parameters for timelapse
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	{% set park = {'min'   : {'x': (min.x / 1.42)|round(3) if round_bed else min.x|round(3),
	'y': (min.y / 1.42)|round(3) if round_bed else min.y|round(3)},
	'max'   : {'x': (max.x / 1.42)|round(3) if round_bed else max.x|round(3),
	'y': (max.y / 1.42)|round(3) if round_bed else max.y|round(3)},
	'center': {'x': (max.x-(max.x-min.x)/2)|round(3),
	'y': (max.y-(max.y-min.y)/2)|round(3)}} %}
	
	{% if params.ENABLE %}
	{% if params.ENABLE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=enable VALUE={True if params.ENABLE|lower == 'true' else False}
	{% else %}
	{action_raise_error("ENABLE=%s not supported. Allowed values are [True, False]" % params.ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.VERBOSE %}
	{% if params.VERBOSE|lower is in ['true', 'false'] %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=verbose VALUE={True if params.VERBOSE|lower == 'true' else False}
	{% else %}
	{action_raise_error("VERBOSE=%s not supported. Allowed values are [True, False]" % params.VERBOSE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_X %}
	{% if params.CUSTOM_POS_X|float >= min.x and params.CUSTOM_POS_X|float <= max.x %}
	{% set _dummy = tl.park.custom.update({'x':params.CUSTOM_POS_X|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_X=%s must be within [%s - %s]" % (params.CUSTOM_POS_X, min.x, max.x))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_Y %}
	{% if params.CUSTOM_POS_Y|float >= min.y and params.CUSTOM_POS_Y|float <= max.y %}
	{% set _dummy = tl.park.custom.update({'y':params.CUSTOM_POS_Y|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_Y=%s must be within [%s - %s]" % (params.CUSTOM_POS_Y, min.y, max.y))}
	{% endif %}
	{% endif %}
	{% if params.CUSTOM_POS_DZ %}
	{% if params.CUSTOM_POS_DZ|float >= min.z and params.CUSTOM_POS_DZ|float <= max.z %}
	{% set _dummy = tl.park.custom.update({'dz':params.CUSTOM_POS_DZ|float|round(3)}) %}
	{% else %}
	{action_raise_error("CUSTOM_POS_DZ=%s must be within [%s - %s]" % (params.CUSTOM_POS_DZ, min.z, max.z))}
	{% endif %}
	{% endif %}
	{% if params.PARK_ENABLE %}
	{% if params.PARK_ENABLE|lower is in ['true', 'false'] %}
	{% set _dummy = tl.park.update({'enable':True if params.PARK_ENABLE|lower == 'true' else False}) %}
	{% else %}
	{action_raise_error("PARK_ENABLE=%s not supported. Allowed values are [True, False]" % params.PARK_ENABLE|capitalize)}
	{% endif %}
	{% endif %}
	{% if params.PARK_POS %}
	{% if params.PARK_POS|lower is in ['center','front_left','front_right','back_left','back_right','custom','x_only','y_only'] %}
	{% set dic = {'center'      : {'x': park.center.x   , 'y': park.center.y   , 'dz': 1                },
	'front_left'  : {'x': park.min.x      , 'y': park.min.y      , 'dz': 0                },
	'front_right' : {'x': park.max.x      , 'y': park.min.y      , 'dz': 0                },
	'back_left'   : {'x': park.min.x      , 'y': park.max.y      , 'dz': 0                },
	'back_right'  : {'x': park.max.x      , 'y': park.max.y      , 'dz': 0                },
	'custom'      : {'x': tl.park.custom.x, 'y': tl.park.custom.y, 'dz': tl.park.custom.dz},
	'x_only'      : {'x': tl.park.custom.x, 'y': 'none'          , 'dz': tl.park.custom.dz},
	'y_only'      : {'x': 'none'          , 'y': tl.park.custom.y, 'dz': tl.park.custom.dz}} %}
	{% set _dummy = tl.park.update({'pos':params.PARK_POS|lower}) %}
	{% set _dummy = tl.park.update({'coord':dic[tl.park.pos]}) %}
	{% else %}
	{action_raise_error("PARK_POS=%s not supported. Allowed values are [CENTER, FRONT_LEFT, FRONT_RIGHT, BACK_LEFT, BACK_RIGHT, CUSTOM, X_ONLY, Y_ONLY]"
	% params.PARK_POS|upper)}
	{% endif %}
	{% endif %}
	{% if params.PARK_TIME %}
	{% if params.PARK_TIME|float >= 0.0 %}
	{% set _dummy = tl.park.update({'time':params.PARK_TIME|float|round(3)}) %}
	{% else %}
	{action_raise_error("PARK_TIME=%s must be a positive number" % params.PARK_TIME)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=park VALUE="{tl.park}"
	{% if params.TRAVEL_SPEED %}
	{% if params.TRAVEL_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'travel':params.TRAVEL_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("TRAVEL_SPEED=%s must be larger than 0" % params.TRAVEL_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_SPEED %}
	{% if params.RETRACT_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'retract':params.RETRACT_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_SPEED=%s must be larger than 0" % params.RETRACT_SPEED)}
	{% endif %}
	{% endif %}
	{% if params.EXTRUDE_SPEED %}
	{% if params.EXTRUDE_SPEED|float > 0.0 %}
	{% set _dummy = tl.speed.update({'extrude':params.EXTRUDE_SPEED|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_SPEED=%s must be larger than 0" % params.EXTRUDE_SPEED)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=speed VALUE="{tl.speed}"
	{% if params.EXTRUDE_DISTANCE %}
	{% if params.EXTRUDE_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'extrude':params.EXTRUDE_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("EXTRUDE_DISTANCE=%s must be specified as positiv number" % params.EXTRUDE_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.RETRACT_DISTANCE %}
	{% if params.RETRACT_DISTANCE|float >= 0.0 %}
	{% set _dummy = tl.extruder.update({'retract':params.RETRACT_DISTANCE|float|round(3)}) %}
	{% else %}
	{action_raise_error("RETRACT_DISTANCE=%s must be specified as positiv number" % params.RETRACT_DISTANCE)}
	{% endif %}
	{% endif %}
	{% if params.FW_RETRACT %}
	{% if params.FW_RETRACT|lower is in ['true', 'false'] %}
	{% if 'firmware_retraction' in printer.configfile.settings %}
	{% set _dummy = tl.extruder.update({'fw_retract': True if params.FW_RETRACT|lower == 'true' else False}) %}
	{% else %}
	{% set _dummy = tl.extruder.update({'fw_retract':False}) %}
	{% if params.FW_RETRACT|capitalize == 'True' %}
	{action_raise_error("[firmware_retraction] not defined in printer.cfg. Can not enable fw_retract")}
	{% endif %}
	{% endif %}
	{% else %}
	{action_raise_error("FW_RETRACT=%s not supported. Allowed values are [True, False]" % params.FW_RETRACT|capitalize)}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=extruder VALUE="{tl.extruder}"
	{% if printer.configfile.settings['gcode_macro pause'] is defined %}
	{% set _dummy = tl.macro.update({'pause': printer.configfile.settings['gcode_macro pause'].rename_existing}) %}
	{% endif %}
	{% if printer.configfile.settings['gcode_macro resume'] is defined %}
	{% set _dummy = tl.macro.update({'resume': printer.configfile.settings['gcode_macro resume'].rename_existing}) %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=macro VALUE="{tl.macro}"

[gcode_macro TIMELAPSE_TAKE_FRAME]
description = Take Timelapse shoot
variable_enable = False
variable_takingframe = False
variable_park = {'enable': False,
	'pos'   : 'center',
	'time'  : 0.1,
	'custom': {'x': 0, 'y': 0, 'dz': 0},
	'coord' : {'x': 0, 'y': 0, 'dz': 0}}
variable_extruder = {'fw_retract': False,
	'retract': 1.0,
	'extrude': 1.0}
variable_speed = {'travel': 100,
	'retract': 15,
	'extrude': 15}
variable_verbose = True
variable_restore = {'absolute': {'coordinates': True, 'extrude': True}, 'speed': 1500, 'e':0, 'factor': {'speed': 1.0, 'extrude': 1.0}}
variable_macro = {'pause': 'PAUSE', 'resume': 'RESUME'}
variable_is_paused = False
gcode = 
	{% set hyperlapse = True if params.HYPERLAPSE and params.HYPERLAPSE|lower =='true' else False %}
	{% if enable %}
	{% if (hyperlapse and printer['gcode_macro HYPERLAPSE'].run) or
	(not hyperlapse and not printer['gcode_macro HYPERLAPSE'].run) %}
	{% if park.enable %}
	{% set pos = {'x': 'X' + park.coord.x|string if park.pos != 'y_only' else '',
	'y': 'Y' + park.coord.y|string if park.pos != 'x_only' else '',
	'z': 'Z'+ [printer.gcode_move.gcode_position.z + park.coord.dz, printer.toolhead.axis_maximum.z]|min|string} %}
	{% set restore = {'absolute': {'coordinates': printer.gcode_move.absolute_coordinates,
	'extrude'    : printer.gcode_move.absolute_extrude},
	'speed'   : printer.gcode_move.speed,
	'e'       : printer.gcode_move.gcode_position.e,
	'factor'  : {'speed'  : printer.gcode_move.speed_factor,
	'extrude': printer.gcode_move.extrude_factor}} %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=restore VALUE="{restore}"
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, minimum extruder temperature not reached!")}{% endif %}
	{% else %}
	{% if extruder.fw_retract %}
	G10
	{% else %}
	M83
	G0 E-{extruder.retract} F{speed.retract * 60}
	{% endif %}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=True
	{macro.pause}
	SET_GCODE_OFFSET X=0 Y=0
	G90
	{% if "xyz" not in printer.toolhead.homed_axes %}
	{% if verbose %}{action_respond_info("Timelapse: Warning, axis not homed yet!")}{% endif %}
	{% else %}
	G0 {pos.x} {pos.y} {pos.z} F{speed.travel * 60}
	{% endif %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=takingframe VALUE=True
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	M400
	{% endif %}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE={hyperlapse}
	{% endif %}
	{% else %}
	{% if verbose %}{action_respond_info("Timelapse: disabled, take frame ignored")}{% endif %}
	{% endif %}

[gcode_macro _TIMELAPSE_NEW_FRAME]
description = action call for timelapse shoot. must be a seperate macro
gcode = 
	{action_call_remote_method("timelapse_newframe",
	macropark=printer['gcode_macro TIMELAPSE_TAKE_FRAME'].park,
	hyperlapse=params.HYPERLAPSE)}

[delayed_gcode _WAIT_TIMELAPSE_TAKE_FRAME]
gcode = 
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% set factor = {'speed': printer.gcode_move.speed_factor, 'extrude': printer.gcode_move.extrude_factor} %}
	{% if tl.takingframe %}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_TAKE_FRAME DURATION=0.5
	{% else %}
	{tl.macro.resume} VELOCITY={tl.speed.travel}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_TAKE_FRAME VARIABLE=is_paused VALUE=False
	{% if not printer[printer.toolhead.extruder].can_extrude %}
	{action_respond_info("Timelapse: Warning minimum extruder temperature not reached!")}
	{% else %}
	{% if tl.extruder.fw_retract %}
	G11
	{% else %}
	G0 E{tl.extruder.extrude} F{tl.speed.extrude * 60}
	G0 F{tl.restore.speed}
	{% if tl.restore.absolute.extrude %}
	M82
	G92 E{tl.restore.e}
	{% endif %}
	{% endif %}
	{% endif %}
	{% if tl.restore.factor.speed   != factor.speed   %} M220 S{(factor.speed*100)|round(0)}   {% endif %}
	{% if tl.restore.factor.extrude != factor.extrude %} M221 S{(factor.extrude*100)|round(0)} {% endif %}
	{% if not tl.restore.absolute.coordinates %} G91 {% endif %}
	{% endif %}

[gcode_macro HYPERLAPSE]
description = Start/Stop a hyperlapse recording
variable_cycle = 0
variable_run = False
gcode = 
	{% set cycle = params.CYCLE|default(30)|int %}
	{% if params.ACTION and params.ACTION|lower == 'start' %}
	{action_respond_info("Hyperlapse: frames started (Cycle %d sec)" % cycle)}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=True
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=cycle VALUE={cycle}
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True
	{% elif params.ACTION and params.ACTION|lower == 'stop' %}
	{% if run %}{action_respond_info("Hyperlapse: frames stopped")}{% endif %}
	SET_GCODE_VARIABLE MACRO=HYPERLAPSE VARIABLE=run VALUE=False
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION=0
	{% else %}
	{action_raise_error("Hyperlapse: No valid input parameter
	Use:
	- HYPERLAPSE ACTION=START [CYCLE=time]
	- HYPERLAPSE ACTION=STOP")}
	{% endif %}

[delayed_gcode _HYPERLAPSE_LOOP]
gcode = 
	UPDATE_DELAYED_GCODE ID=_HYPERLAPSE_LOOP DURATION={printer["gcode_macro HYPERLAPSE"].cycle}
	TIMELAPSE_TAKE_FRAME HYPERLAPSE=True

[gcode_macro TIMELAPSE_RENDER]
description = Render Timelapse video and wait for the result
variable_render = False
variable_run_identifier = 0
gcode = 
	{action_respond_info("Timelapse: Rendering started")}
	{action_call_remote_method("timelapse_render", byrendermacro="True")}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=render VALUE=True
	{printer.configfile.settings['gcode_macro pause'].rename_existing}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5

[delayed_gcode _WAIT_TIMELAPSE_RENDER]
gcode = 
	{% set ri = printer['gcode_macro TIMELAPSE_RENDER'].run_identifier % 4 %}
	SET_GCODE_VARIABLE MACRO=TIMELAPSE_RENDER VARIABLE=run_identifier VALUE={ri + 1}
	{% if printer['gcode_macro TIMELAPSE_RENDER'].render %}
	M117 Rendering {['-','\\','|','/'][ri]}
	UPDATE_DELAYED_GCODE ID=_WAIT_TIMELAPSE_RENDER DURATION=0.5
	{% else %}
	{action_respond_info("Timelapse: Rendering finished")}
	M117
	{printer.configfile.settings['gcode_macro resume'].rename_existing}
	{% endif %}

[gcode_macro TEST_STREAM_DELAY]
description = Helper macro to find stream and park delay
gcode = 
	{% set min = printer.toolhead.axis_minimum %}
	{% set max = printer.toolhead.axis_maximum %}
	{% set act = printer.toolhead.position %}
	{% set tl = printer['gcode_macro TIMELAPSE_TAKE_FRAME'] %}
	{% if act.z > 5.0 %}
	G0 X{min.x + 5.0} F{tl.speed.travel|int * 60}
	G0 X{(max.x-min.x)/2}
	G4 P{tl.park.time|float * 1000}
	_TIMELAPSE_NEW_FRAME HYPERLAPSE=FALSE
	G0 X{max.x - 5.0}
	{% else %}
	{action_raise_error("Toolhead z %.3f to low. Please place head above z = 5.0" % act.z)}
	{% endif %}

[gcode_macro VAR_MODEL]
variable_model = 2
variable_extrudr_num = 2
gcode = 

[stepper_x]
step_pin = PB13
dir_pin = PB15
enable_pin = !PB14
microsteps = 32
rotation_distance = 40
full_steps_per_rotation = 200
endstop_pin = PA10
position_min = -2
position_endstop = -1
position_max = 200
homing_speed = 50
homing_retract_dist = 5
homing_positive_dir = false
second_homing_speed = 5
step_pulse_duration = 0.000008

[stepper_y]
step_pin = PB10
dir_pin = PB12
enable_pin = !PB11
microsteps = 32
rotation_distance = 40
full_steps_per_rotation = 200
endstop_pin = !PC7
position_min = -2
position_endstop = 35
position_max = 300
homing_speed = 50
homing_retract_dist = 15
homing_positive_dir = false
second_homing_speed = 5
step_pulse_duration = 0.000008

[stepper_z]
step_pin = PA6
dir_pin = PB0
enable_pin = !PA7
microsteps = 32
rotation_distance = 4
full_steps_per_rotation = 200
endstop_pin = !PC6
position_max = 305
position_min = -3
homing_speed = 15
homing_retract_dist = 15
second_homing_speed = 5
homing_positive_dir = false
#position_endstop = 5.170

[fan]
pin = PC9

[output_pin BEEP]
pin = PB1

[output_pin POWER]
pin = PB8
value = 1

[output_pin LIGHT]
pin = PA0

[exclude_object]

[configfile]

[gcode_arcs]

[respond]

[force_move]
enable_force_move = true

[firmware_retraction]
retract_length: 1
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 10

[bed_mesh]
speed = 100
horizontal_move_z = 3
mesh_min = 10, 10
mesh_max = 190, 290
probe_count = 3, 4

[extruder]
step_pin = PB6
dir_pin = PB7
enable_pin = PB5
microsteps = 32
rotation_distance = 29
gear_ratio = 50:1
full_steps_per_rotation = 48
nozzle_diameter = 0.400
filament_diameter = 1.750
min_temp = -100
max_temp = 3000
heater_pin = PB3
sensor_type = V51RNTC100K510RG
sensor_pin = PA4
adc_voltage = 3.3
voltage_offset = 0
max_power = 0.7
pressure_advance = 0.2
pressure_advance_smooth_time = 0.150
max_extrude_cross_section = 20
instantaneous_corner_velocity = 10.000
max_extrude_only_distance = 100.0
max_extrude_only_velocity = 50000
max_extrude_only_accel = 5000
step_pulse_duration = 0.000002
control = pid
pid_kp = 11.675
pid_ki = 0.463
pid_kd = 73.550

[extruder1]
step_pin = PC11
dir_pin = PC12
enable_pin = PD2
microsteps = 32
rotation_distance = 29
gear_ratio = 50:1
full_steps_per_rotation = 48
nozzle_diameter = 0.400
filament_diameter = 1.750
min_temp = -100
max_temp = 3000
heater_pin = PB4
sensor_type = V51RNTC100K510RG
sensor_pin = PA5
adc_voltage = 3.3
voltage_offset = 0
max_power = 0.7
pressure_advance = 0.2
pressure_advance_smooth_time = 0.150
max_extrude_cross_section = 20
instantaneous_corner_velocity = 10.000
max_extrude_only_distance = 100.0
max_extrude_only_velocity = 50000
max_extrude_only_accel = 5000
step_pulse_duration = 0.000002
control = pid
pid_kp = 11.675
pid_ki = 0.463
pid_kd = 73.550

[heater_bed]
heater_pin = PB9
sensor_type = V510RNTC100K10KRG
sensor_pin = PA3
adc_voltage = 3.3
voltage_offset = 0
max_power = 1.0
min_temp = -100
max_temp = 10000
control = pid
pid_kp = 49.054
pid_ki = 1.112
pid_kd = 540.818

[heater_generic MAINBOARD]
gcode_id = MB
heater_pin = PC8
max_power = 1.0
sensor_type = V510RNTC100K10KRG
sensor_pin = PA1
adc_voltage = 3.3
voltage_offset = 0
min_temp = -100
max_temp = 1000
control = pid
pid_kp = 53.867
pid_ki = 0.647
pid_kd = 1121.107

[printer]
kinematics = cartesian
max_velocity = 200
max_accel = 8000
max_accel_to_decel = 5000
max_z_velocity = 10
max_z_accel = 1000
square_corner_velocity = 5.0

[bed_mesh default]
#version = 1
#points = 
#	-0.094375, 0.070000, 0.410625
#	-0.095000, -0.031250, -0.062500
#	-0.043125, -0.004375, 0.006250
#	0.119375, 0.192500, 0.307500
#x_count = 3
#y_count = 4
#mesh_x_pps = 2
#mesh_y_pps = 2
#algo = lagrange
#tension = 0.2
#min_x = 10.0
#max_x = 190.0
#min_y = 10.0
#max_y = 289.99

[input_shaper]
shaper_freq_x = 54.2
shaper_type_x = mzv
shaper_freq_y = 43.2
shaper_type_y = 2hump_ei

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 4.780
#*#
#*# [probe]
#*# z_offset = -0.220
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.078125, 0.153125, 0.383125
#*# 	  -0.067500, -0.041875, -0.105625
#*# 	  0.012500, 0.024375, -0.007500
#*# 	  0.117500, 0.194375, 0.235625
#*# x_count = 3
#*# y_count = 4
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 190.0
#*# min_y = 10.0
#*# max_y = 289.99
